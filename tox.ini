[tox]
envlist = pep8,docstyle,unit
skipsdist = True

[settings]
IMAGE_NAME = "puma:l00"

[testenv:build]
whitelist_externals = docker
commands = docker build --file docker/Dockerfile --tag {[settings]IMAGE_NAME} {toxinidir}

[testenv:shell]
whitelist_externals = docker
commands = docker run --rm -it -v {toxinidir}:/app {[settings]IMAGE_NAME} zsh

[testenv:notebook]
whitelist_externals = docker
commands = docker run --rm -it -v {toxinidir}:/app -p 8888:8888 {[settings]IMAGE_NAME} jupyter notebook --ip=0.0.0.0

[testenv:pep8]
whitelist_externals = docker
commands = docker run --rm -it -v {toxinidir}:/app {[settings]IMAGE_NAME} flake8

[testenv:docstyle]
whitelist_externals = docker
commands = docker run --rm -it -v {toxinidir}:/app {[settings]IMAGE_NAME} pydocstyle --verbose

[testenv:unit]
whitelist_externals = docker
commands = docker run --rm -it -v {toxinidir}:/app -e PYTHONPATH=. {[settings]IMAGE_NAME} pytest -p no:cacheprovider -s tests/


[flake8]
# W503 - is said to be incompatible with current PEP8, however flake8 is
#   not updated to handle it
# W504 skipped because it is overeager and unnecessary
ignore = W503,W504
show-source = True
exclude = .git,.venv,.tox,dist,doc,*egg,build,venv,notebooks,tests
import-order-style = pep8
max-line-length = 80


[pydocstyle]
# D104 Missing docstring in public package
# D203 1 blank line required before class docstring
# D213 Multi-line docstring summary should start at the second line
# D214 Section is over-indented
# D215 Section underline is over-indented
# D401 First line should be in imperative mood; try rephrasing
# D405 Section name should be properly capitalized
# D406 Section name should end with a newline
# D407 Missing dashed underline after section
# D408 Section underline should be in the line following the section's name
# D409 Section underline should match the length of its name
# D410 Missing blank line after section
# D411 Missing blank line before section
ignore = D104,D203,D213,D214,D215,D401,D405,D406,D407,D408,D409,D410,D411
match-dir = ^(?!\.tox|venv|tests).*
match = ^(?!setup).*\.py

